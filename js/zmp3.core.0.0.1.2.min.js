var zmp3Login={succCallback:"",error:0,isZalo:!1,isCall114:!1,continueUrl:"http://mp3.zing.vn",init:function(){var t=$("#loginBox");$(".fn-zalo",t).click(function(){return zmp3Login.isZalo=!0,zmp3Login.show(),!1}),$(".fn-zingid",t).click(function(){return zmp3Login.isZalo=!1,zmp3Login.show(),!1})},show:function(t){if(this.succCallback=t,!MP3.ACCOUNT_ID){-1===MP3.continueUrl.indexOf("/mymusic")&&(MP3.continueUrl=window.location.href);var e=$("#loginBox");$(".fn-zalo",e).removeClass("active"),$(this).addClass("active");var a='<div class="login-zalo sync-zalo"> <a href="https://id.zalo.me/account?continue='+MP3.continueUrl+'"  class="button-login-zalo">Đăng nhập bằng Zalo</a><p class="tor">Vui lòng chuyển đổi kho nhạc cũ và thông tin VIP từ Zing ID sang tài khoản Zalo</p><a href="http://asset.mp3.zing.vn" class="btn btn-sync"><i class="i-sync"></i>Chuyển đổi nhạc sang Zalo</a></div>';$(".fn-content",e).html(a);var n="https://id.zalo.me/account?continue="+window.location.origin+"/auth/zalo/callback_v2?continue="+window.location.origin+window.location.pathname+window.location.search;return $("#fn-login-zalo").attr("href",n),$("#fn-login-zalo").attr("onclick",""),e.removeClass("none"),zmp3UI.bodyMask(1),!1}return $.isFunction(this.succCallback)&&this.succCallback(),!0}};zmp3User={init:function(){$(".fn-login").click(function(){if(!MP3.ACCOUNT_ID){var t=$(this).attr("href");return t&&-1!==t.indexOf("/")&&(MP3.continueUrl=zmp3Login.continueUrl+t),zmp3Login.show(),!1}})},submitCb:function(t){}};var zmp3Share={url:"",share:function(t){var e=t.attr("href");switch(t.data("net")){case"gp":url="https://plus.google.com/share?url="+e;break;case"zm":url="//link.apps.zing.vn/share?u="+e;break;default:var a=e.replace("%3Futm_source%3Ddesktop%26utm_medium%3Dfacebook%26utm_campaign%3Dshare",""),n="%3Fevent_label%3D"+a;url="https://www.facebook.com/dialog/share?app_id=1603079626622346&display=popup&caption=mp3.zing.vn&redirect_uri=http://"+location.host+"/link/fb-redirect"+n+"&href="+e;ga("mp3.send","event",{eventCategory:"ShareZingMP3Desktop",eventAction:"Click-facebook",eventLabel:a})}return window.open(url,"share","height=600,width=600"),!1},getPageId:function(t){""==t&&(t=window.location.href);var e=t.split("/");return e.length>=6?e[5].substring(0,8):""},getPageName:function(t){""==t&&(t=window.location.href);var e=t.split("/");return e.length>=4?e[3]:""}},zmp3Tab={init:function(){if(MP3.ZALO_ID&&!MP3.VIP){var t=$("#tabService"),e=t.data("panel");zmp3SongTool.buildDlBox(t,$(e),function(a){if(a){for(var n in a.data)if(a.data[n].vip){$(".fn-"+n,$(e)).removeClass("ghost-button");var i=$(".fn-size-"+n,$(e)).parent();i.html(i.html().replace("miễn phí","VIP"))}a.msg&&($(".fn-list",$(e)).addClass("none"),$(".fn-download-off",$(e)).removeClass("none"))}zmp3Tab.showTab(t)})}$(".fn-tab").click(function(){var t=$(this),e=t.data("panel");return".fn-tab-panel-addto"==e?zmp3Login.show(function(){zmp3SongTool.buildPlaylistBox(t,$(e),function(){zmp3Tab.showTab(t)})}):".fn-tab-panel-service"==e?zmp3SongTool.buildDlBox(t,$(e),function(a){if(a){for(var n in a.data)if(a.data[n].vip){$(".fn-"+n,$(e)).removeClass("ghost-button");var i=$(".fn-size-"+n,$(e)).parent();i.html(i.html().replace("miễn phí","VIP"))}0===a.err&&"Success"==a.msg||($(".fn-list",$(e)).addClass("none"),$(".fn-download-off",$(e)).removeClass("none"))}zmp3Tab.showTab(t)}):zmp3Tab.showTab(t),!1}),$(".fn-closetab").click(function(){return zmp3Tab.showTab($($(this).data("tab"))),!1})},showTab:function(t){var e=t.data("panel"),a=$('.fn-tab[data-group="'+t.data("group")+'"]');a.removeClass("active"),t.parent().siblings().removeClass("active"),$(t.data("group")).addClass("none"),a.each(function(){$($(this).data("panel")).addClass("none")}),t.data("show")?($(e).addClass("none"),a.data("show",!1),t.parent().removeClass("active")):(a.data("show",!1),t.data("show",!0),t.parent().addClass("active"),t.addClass("active"),$(e).removeClass("none"))}},zmp3SongTool={item:!1,init:function(){$(document).on("click",".fn-dlsong",function(){return zmp3SongTool.showDlBox($(this)),!1}),$(document).on("click",".fn-share",function(){return zmp3SongTool.showShareBox($(this)),!1}),$(".fn-add").each(function(){var t=this;"fav"==$(t).data("from")&&$.get(MP3.XHR_URL+"/user/favorite?action=check-exists",$(t).data(),function(e){0===e.err&&$(t).addClass("added").html($(t).html().replace("Thêm vào","Đã thêm"))}),$(t).click(function(){return zmp3Login.show()&&(zmp3SongTool.item=$(this),zmp3SongTool.addPlaylistItem($(this))),!1})}),$(document).on("click",".fn-addto",function(){return zmp3Login.show()&&zmp3SongTool.showAddBox($(this)),!1}),$(".fn-addfav").click(function(){var t=$($(this).data("item"));if(zmp3Login.show()){var e=$(t).data(),a=parseInt(t.data("added")),n=(new Date).getTime();this.item;(isNaN(a)||a+800<n)&&(t.data("added",n),$.post(MP3.XHR_URL+"/user/favorite?action=add-item",e,function(e){0==e.err&&t.addClass("added"),zmp3UI.showMsg(e.msg,e.err)}))}return!1}),$("form.fn-playlist").submit(function(t){var e=this;return e.name.value.trim().length<1?zmp3UI.showMsg("Vui lòng nhập tên playlist!",1):$(e).attr("disabled")||($(e).attr("disabled",!0),this.item_id.value=zmp3SongTool.item.data("id"),$.post($(e).attr("action"),$(e).serialize(),function(t){$(e).attr("disabled",!1),0===t.err&&zmp3SongTool.buildPlaylistItem(t.data,$($(e).data("playlist-box"))),zmp3UI.showMsg(t.msg,t.err)})),!1}),$(".fn-rmitem").click(function(){return zmp3SongTool.removeItem($($(this).data("item"))),!1}),onBlurBind("#playlistBox",function(t){zmp3SongTool.item&&($("#playlistBox").addClass("none"),zmp3SongTool.item.data("active")&&$(".fn-"+zmp3SongTool.item.data("type")).removeClass(zmp3SongTool.item.data("active")),$(".fn-songbox").addClass("none"))})},showPlaylistBox:function(t,e){var a=$("#playlistBox"),n=this.item.data("pids")?this.item.data("pids").split(","):[];$(".fn-add",a).removeClass("added"),$("input",a).prop("checked",!1);for(var i in n)n[i].length>1&&$("input",$("[data-pid="+n[i]+"]",a).addClass("added")).prop("checked",!0);a.removeClass("none").css("top",t).css("left",e).css("display","block")},addPlaylistItem:function(t){var e=$(t).data(),a=!1,n=parseInt(t.data("added")),i=(new Date).getTime(),o=this.item,s=[];try{e.id=o.data("id"),o.data("pids")&&(s=o.data("pids").split(","))}catch(t){}for(var l in s)if(s[l]===e.pid){a=!0;break}t.hasClass("added")?zmp3SongTool.removeItem($(t.data("item")),function(){t.removeClass("added").html(t.html().replace("Đã thêm","Thêm vào")),$("input",t).length>0&&$("input",t).removeAttr("checked")},!0):!a&&(isNaN(n)||n+800<i)&&(t.data("added",i),$.post(MP3.XHR_URL+"/user/favorite?action=add-item",e,function(a){if(0==a.err){$("input",t).length>0&&$("input",t).attr("checked","checked"),t.addClass("added").html(t.html().replace("Thêm vào","Đã thêm")),s.push(e.pid);try{o.data("pids",s.join(","))}catch(t){}}zmp3UI.showMsg(a.msg,a.err)}))},removeItem:function(t,e,a){var n=$(t).data(),i=this,o="Bạn chắc chắn muốn xóa ";"song"==n.type?o+="bài hát":"artist"==n.type?o+="nghệ sĩ":o+=n.type,zmp3UI.bodyMask(1),zmp3UI.confirm("Xác nhận",n.name&&!n.pid?o+" <strong>"+n.name+"</strong> ra khỏi danh sách?":o+" này ra khỏi danh sách?",function(o){if(o){(!n.id||n.id.length<4)&&(n.id=i.item.data("id"));for(var s in n)"string"!=typeof n[s]&&"number"!=typeof n[s]&&delete n[s];t.data("removed")||(t.data("removed",!0),$.post(MP3.XHR_URL+"/user/favorite?action=remove-item",n,function(n){if(0==n.err){var i=$(".fn-follow",t.parent());i.length>0?(i.removeClass("none").removeClass("active"),$(".fn-rmitem",t.parent()).addClass("none")):(i=$(".fn-ufollow",t.parent())).length>0?i.removeClass("none"):a||t.remove()}else t.data("removed",!1);zmp3UI.showMsg(n.msg,n.err),$.isFunction(e)&&e(n)}))}$("#confirmBox .fn-close").click(),zmp3UI.bodyMask(0)})},showAddBox:function(t){this.item=$(t.data("item"));var e=$(t).offset(),a=this.item.data("type");e.top+=$(t).height()+8,e.left+=$(t).width()/2,$(".fn-songbox").addClass("none"),this.item.data("active")&&($(".fn-"+a).removeClass(this.item.data("active")),this.item.addClass(this.item.data("active"))),"song"!=a&&"playlist"!=a||($(t).data("rendered")?zmp3SongTool.showPlaylistBox(e.top,e.left):($(".fn-addto").data("rendered",!0),this.buildPlaylistBox(this.item,$("#playlistBox"),function(){zmp3SongTool.showPlaylistBox(e.top,e.left)})))},showDlBox:function(t){this.item=$(t.data("item"));var e=this.item.data("type")||"song",a=t.offset(),n=this.item.data("active"),i="dlbox"+e+this.item.data("id"),o=$("#"+i);$(".fn-"+e).removeClass(n),this.item.addClass(n),$(".fn-box"+e).addClass("none"),o.length>0?o.css({left:a.left+2-o.width()/2+"px",top:a.top+28+"px"}).removeClass("none"):((o=$(document.getElementById("dlbox"+e).cloneNode(!0))).attr("id",i),$("body").append(o),o.css({left:a.left+2-o.width()/2+"px",top:a.top+28+"px"}),this.buildDlBox(this.item,o,function(t){o.removeClass("none"),0!==t.err&&($(".box-tooltip.box-download.fn-boxsong").addClass("none"),zmp3UI.showMsg(t.msg,1)),MP3.VIP||"undefined"==typeof ZVip||$(".fn-viprequire",o).click(function(t){if(!MP3.VIP)return o.addClass("none"),ZVip.Fpackage(),!1}),onBlurBind(zmp3SongTool.item,function(){$(".fn-"+zmp3SongTool.item.data("type")).removeClass(zmp3SongTool.item.data("active")),o.addClass("none")})}))},showShareBox:function(t){$(".fn-boxsong").addClass("none"),this.item=$($(t).data("item"));var e=t.offset(),a="shareSongBox"+this.item.data("id"),n=$("#"+a);$(".fn-"+this.item.data("type")).removeClass(this.item.data("active")),this.item.addClass(this.item.data("active")),$(".fn-songbox").addClass("none"),n.length>0?n.css("top",e.top+28).css("left",e.left-80+n.width()/2).removeClass("none"):((n=$(document.getElementById("shareSongBox").cloneNode(!0))).attr("id",a),$("body").append(n),$(".fn-sharelink",n).attr("href",t.attr("href")).attr("data-id",this.item.data("id")).removeClass("none").click(function(){return zmp3Share.share($(this)),!1}),n.css("top",e.top+28).css("left",e.left-80+n.width()/2).removeClass("none"),onBlurBind(zmp3SongTool.item,function(){$(".fn-"+zmp3SongTool.item.data("type")).removeClass(zmp3SongTool.item.data("active")),n.addClass("none")}))},buildDlBox:function(t,e,a){this.item=t;var n=t.data("code");if(n!==e.data("build-dl")){e.data("build-dl",n);var i=t.data("type")||"song";$(".fn-list a",e).each(function(){$(this).parent().addClass("none")}),$.get(MP3.XHR_URL+"/media/get-url-download?type="+i,t.data(),function(n){if(0===n.err){var i=n.data.sources;for(var o in i)$(".fn-"+o,e).parent().removeClass("none"),$(".fn-size-"+o,e).parent().removeClass("none"),$(".fn-"+o,e).attr("data-id",t.data().id),$(".fn-"+o,e).attr("data-bit",o),"128"===o?$(".fn-"+o,e).attr("href",i[o].link).click(function(t){if(i[o].vip&&!MP3.VIP)return ZVip.Fpackage($(this).data("step")),!1}):$(".fn-"+o,e).attr("href",i[o].link).click(function(t){}),i[o].size>0&&$(".fn-size-"+o,e).html((i[o].size/1048576).toFixed(2));n.data.qr&&$(".fn-qr",e).attr("src","data:image/png;base64,"+n.data.qr),$.isFunction(a)&&a(n)}})}else $.isFunction(a)&&a()},buildPlaylistItem:function(t,e){var a=0===t.id?$(".fn-fav",e)[0].cloneNode(!0):$(".fn-item",e)[0].cloneNode(!0);$(".fn-name",a).html(t.name),$(".fn-link",a).attr("href",t.link),$(".fn-total",a).length>0&&($(".fn-total",a).html(t.total),0==t.id&&"playlist"==t.type&&$(".fn-total",a).parent("span").remove()),$(a).attr("id",t.id),t.added&&($(".fn-add",a).addClass("added"),$("input",a).length>0&&$("input",a).prop("checked",!0)),$(".fn-add",a).attr("data-pid",t.id).attr("data-from","playlist").attr("data-item","#"+t.id+" .fn-add").attr("data-name",t.name).attr("data-type",t.type).attr("data-title",t.name).attr("data-pid",t.id).click(function(t){t.preventDefault(),zmp3SongTool.addPlaylistItem($(this));$(this).data();return!1}),$(a).removeClass("none"),$(".fn-list",e).append(a)},buildPlaylistBox:function(t,e,a){this.item=t,e.data("build-playlist")?$.isFunction(a)&&a():(e.data("build-playlist",1),$.get(MP3.XHR_URL+"/user/get-playlist",t.data(),function(t){if(t.data){for(x in t.data)zmp3SongTool.buildPlaylistItem(t.data[x],e);$.isFunction(a)&&a()}}))}},zmp3UI={initBefore:!1,init:function(){this.initBefore||this.profile(),this.followInit(),$(".fn-tooltip").click(function(){$(this).data("show")?($($(this).data("box")).addClass("none"),$(this).data("show",!1)):($($(this).data("box")).removeClass("none"),$(this).data("show",!0))}),$(".fn-show").length>0&&$(".fn-show").click(function(){return zmp3UI.showhide($($(this).data("box"))),!1}),$(".fn-showhere").length>0&&$(".fn-showhere").click(function(){var t=$(this).offset(),e=t.top,a=$($(this).data("box"));return e+a.height()+20>$(window).height()+$(window).scrollTop()?e-=a.height()+12:e+=$(this).height(),a.css({top:e+"px",left:t.left+6-a.width()/2+"px"}),$(a).hasClass("none")?$(a).removeClass("none"):$(a).addClass("none"),!1}),$(".fn-showhide").length>0&&$(".fn-showhide").click(function(){return $($(this).data("hide")).addClass("none"),$($(this).data("show")).removeClass("none"),!1}),$(".fn-cb").length&&$(".fn-cb").click(function(){var t=window[$(this).data("fn")];return void 0!==t&&t.clickCb.apply(t,[this]),!1}),$(".fn-expand").each(function(){var t=$($(this).data("box")),e=parseInt(t.data("min"));t[0]&&e>=t[0].scrollHeight&&(t.css("height","auto"),$(this).remove())}),$(document).on("click",".fn-expand",function(){var t=$($(this).data("box"));return t.data("expand")?(t.css("height",t.data("min")),t.data("expand",0),$(this).html("Xem thêm"),$(window).scrollTop($(this).data("top"))):($(this).data("top",$(window).scrollTop()),t.css("height",t.data("max")),t.data("expand",1),$(this).html("Rút gọn")),!1}),$(".fn-number").each(function(){$(this).html(zmp3Number.format($(this).html()))}),$(".fn-date").each(function(){$(this).html(zmp3DateTime.format($(this).html()))}),$(".fn-scrollbar").mCustomScrollbar({scrollInertia:0,scrollbarPosition:"outside",autoHideScrollbar:!0,autoExpandScrollbar:!0,mouseWheel:{preventDefault:!0}}),this.initBefore||$(".fn-sharelink").click(function(){return zmp3Share.share($(this)),!1}),$("form.fn-ajax").submit(function(){t="undefined";if($(this).data("cb"))var t=window[$(this).data("cb")];return $.post($(this).attr("action"),$(this).serialize(),function(e){void 0!==t&&t.submitCb.apply(t,[e,this])}),!1}),$(".fn-close").click(function(){var t=window[$(this).data("cb")];return void 0!==t&&t.closeCb.apply(t,[this]),zmp3UI.bodyMask(0),$($(this).data("box")).addClass("none"),!1}),$(".fn-param").click(function(){return location.href=zmp3UI.replaceUrlParam($(this)),!1});for(var t=$(".fn-bar"),e=0,a=0;a<t.length;a++){var n=$(t[a]),i=parseInt(n.data("total"));!isNaN(i)&&e<i&&(e=i)}for(a=0;a<t.length;a++){var n=$(t[a]),i=parseInt(n.data("total"));isNaN(i)||((i=100*i/e)<95&&(i+=4),n.css("width",i+"%"))}zmp3Toolbar.init(),$(".fn-time").each(function(){$(this).html(zmp3DateTime.format($(this).html()))}),-1===location.host.search("lt.mp3.zing.vn")&&function(t,e,a){var n,i=t.getElementsByTagName(e)[0];t.getElementById(a)||((n=t.createElement(e)).id=a,n.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=1603079626622346&version=v2.7",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk"),this.highlight(),this.initBefore||($(".fn-banner-off").click(function(){return MP3.VIP?zmp3UI.setBannerOff(!MP3.BANNER_OFF,!0):"undefined"!=typeof ZVip&&ZVip.Fpackage(),!1}),this.initBefore=!0),$(".fn-total-play").each(function(){if($(this).data("id")){var t=this;$.get(MP3.XHR_URL+"/get-counter",$(this).data(),function(e){e.data&&e.data.total>=0&&$(t).html(zmp3Number.format(e.data.total))})}}),$(".fn-slide-show").each(function(){var t=this,e={dots:!1,prevArrow:$(".fn-prev",this),nextArrow:$(".fn-next",this),infinite:!0,speed:1500,slidesToShow:6,slidesToScroll:6};if(null!==$(this).data()&&$.extend(e,e,$(this).data()),null!==$(this).data("customNav")){var a=$($(this).data("customNav"));$(".fn-slide",this).slick(e).on("beforeChange",function(t,n,i,o){a.removeClass("active"),$(a[o/e.slidesToShow]).addClass("active")}),$(a[0]).addClass("active"),a.click(function(){return $(".fn-slide",t).slick("slickGoTo",$(this).data("ord")),!1})}else $(".fn-slide",this).slick(e);null!==$(t).data("cb")&&void 0!==window[$(t).data("cb")]&&$(".fn-slide",t).on("afterChange",function(e,a,n){var i=window[$(t).data("cb")];void 0!==i&&i.afterChange.apply(i,[a,n])})});var o=(new Date).getHours();o>18&&o<21&&$(".fn-ytsubscribe").removeClass("none"),$(".fn-useravatar").attr("src",$(".fn-profile .fn-thumb").attr("src"))},bodyMask:function(t){t?$(".body-mask").removeClass("none"):$(".body-mask").addClass("none")},showmodal:function(t){return this.showhide($($(t).data("box")),function(t){zmp3UI.bodyMask(t)}),!1},showhide:function(t,e){t.hasClass("none")&&(t.css("display","none"),t.removeClass("none")),t.slideToggle(200,function(){$.isFunction(e)&&e(!1)})},highlight:function(){var t=$(".fn-highlight");if(t.length){for(var e=0;e<t.length;e++){var a=$(t[e]);if(a.data("highlight")){var n=a.html().split("/"),i=this.matchMaker(n.length>1?n[1].trim():n[0],a.data("highlight").stripViet().toLowerCase());i&&a.html((n.length>1?n[0]+"/ ":"")+i)}}t.removeClass("fn-highlight")}},matchMaker:function(t,e){var a=t.stripViet().toLowerCase().indexOf(e);return a>-1&&t.substr(0,a)+'<strong class="mark">'+t.substr(a,e.length)+"</strong>"+t.substr(a+e.length,t.length)},replaceUrlParam:function(t){var e,a,n=t.attr("href"),i=t.data("param"),o=t.data("value");return(!n||n.length<10)&&(n=location.href),"genre"==i&&("-1"!=n.indexOf("?genre=")&&(n=(n=n.replace(/genre=[0-9]&/g,"?")).replace(/genre=[0-9]/g,"")),"-1"!=n.indexOf("&genre=")&&(n=n.replace(/&genre=[0-9]/g,""))),"remove"==t.data("op")?(e=new RegExp("(\\&|\\?)"+i+"="+o),a=n.replace(e,"$1").replace("&&","&").replace(new RegExp("\\&$"),"&")):"add"==t.data("op")?(e=new RegExp("(\\&|\\?)"+i+"="+o)).test(n)||(a=n+(n.indexOf("?")>-1?"&":"?")+i+"="+o):((e=new RegExp("(\\&|\\?)("+i+"=).*?(&|$)")).test(n)?a=o&&o.length>0?n.replace(e,"$1$2"+o+"$3"):n.replace(e,"$3"):void 0!==o&&(a=n+(n.indexOf("?")?"&":"?")+i+"="+o),a===n&&(a=a+(a.indexOf("?")>0?"&":"?")+i+"="+o)),a=a.replace("??","?")},setBannerOff:function(t,e){MP3.BANNER_OFF=t;var a=new Date;a.setTime(a.getTime()+2592e6);var n=MP3.BANNER_OFF?1:0;$.cookie("BANNER_OFF",n,{path:"/",domain:"zing.vn",expires:a}),MP3.BANNER_OFF?($("._bannerAds").remove(),$(".fn-banner-off").removeClass("active").each(function(){$(this).html($(this).html().replace("Tắt","Bật"))})):e&&location.reload()},showMsg:function(t,e,a){e=0==e?"success":"error",a||(a=5e3);var n=$("#msgBox .fn-item")[0].cloneNode(!0);$("#msgBox").append(n),$(n).removeAttr("id").addClass(e).removeClass("none"),$(".fn-content",n).html(t),setTimeout(function(){$(n).fadeOut("slow",function(){$(n).remove()})},a)},confirm:function(t,e,a){var n=$("#confirmBox .fn-item")[0].cloneNode(!0);$(n).remove(),$("#confirmBox").append(n),$(n).removeAttr("id").removeClass("none"),$(".fn-title",n).html(t),$(".fn-content",n).html(e),$(".fn-ok",n).click(function(){return $(n).remove(),$.isFunction(a)&&a(!0),!1}),$(".fn-close",n).click(function(){return $(n).remove(),$.isFunction(a)&&a(!1),!1})},sidebar:function(){var t=$(".fn-sidebar-fixed");if(t.length>0){var e=$(window).scrollTop(),a=0,n=$(window).height(),i=$(".quick-link").height(),o=t.siblings("div").offset().top;e<o+i?t.css("margin-top",e>20?20-e:e+"px"):(t.css("margin-top",20-o+"px"),$("footer").offset().top-e<n&&(a=$("footer").height()+20+i));for(var s=$(".fn-scrollbar",t),l=0;l<s.length;l++){var r=$(s[l]),d=a+r.offset().top-e;r.height(n-d-30+"px")}}},buildItem:function(t,e,a){var n=(a||"song")+e.id;$(t).attr("id",n).data("id",e.id).data("code",e.code||0).removeClass("none"),$(t).attr("data-id",e.id),$(t).attr("data-code",e.code||0),$(".fn-link",t).attr("href",e.link).attr("title",e.name+" - "+e.artist),$(".fn-name",t).html(e.name),e.video_link?$(".fn-video_link",t).attr("href",e.video_link).attr("title","Xem MV "+e.name+" - "+e.artist):$(".fn-video_link",t).remove();var i=$(".fn-artist",t);$(".fn-artist_list",t).empty();for(var o in e.artists){var s=i[0].cloneNode(!0);$(s).empty().append('<a href="'+e.artists[o].link+'" title="'+(e.artists.length<2?e.artist:e.artists[o].name)+'">'+e.artists[o].name+"</a>"),$(".fn-artist_list",t).append(s),parseInt(o)<e.artists.length-1&&$(".fn-artist_list",t).append("<span>, </span>")}return $(".fn-thumb",t).attr("src",e.thumbnail),$(".fn-addto",t).length&&($(".fn-dlsong",t).data("item","#"+n),$(".fn-addto",t).data("item","#"+n),$(".fn-share",t).data("item","#"+n).attr("href",e.link)),t},getContentWidth:function(){return $(".wrap-body .wrap-content").width()},followInit:function(){var t=$(".fn-followed");if(t.length>0){for(var e=[],a=[],n=[],i=0;i<t.length;i++)$(t[i]).data("id")?e.push($(t[i]).data("id")):$(t[i]).data("rid")?a.push($(t[i]).data("rid")):$(t[i]).data("uid")&&n.push($(t[i]).data("uid"));$.get(MP3.XHR_URL+"/get-follow",{ids:e.join(","),rids:a.join(","),uids:n.join(",")},function(e){if(e.data)for(var a=0;a<t.length;a++){var n=$(t[a]).data("id")||$(t[a]).data("rid")||$(t[a]).data("uid"),i=e.data[n];i>=0&&$(t[a]).html(zmp3Number.format(i))}}),window.addEventListener("buildUserInfo",function(t){MP3.ACCOUNT_ID&&$.get(MP3.XHR_URL+"/get-followed",function(t){if(t.data)for(var e=0;e<t.data.length;e++){var a=$(".fn-follow[data-id="+t.data[e].id+"]");if(a.length>0){var n=$(".fn-rmitem",a.parent());n.length>0?(a.addClass("none"),n.removeClass("none")):a.addClass("active")}}})}),$(".fn-follow").click(function(){var t=$(this);return zmp3Login.show(function(){var e=$(".fn-followed[data-id="+t.data("id")+"]");t.hasClass("active")?zmp3SongTool.removeItem(t,function(a){t.removeClass("active");var n=parseInt(e.html());n>0&&e.html(n-1)}):$.post(MP3.XHR_URL+"/post-follow",t.data(),function(e){if(0===e.err){t.addClass("active"),$(".fn-followed[data-id="+t.data("id")+"]").html(e.data.total);var a=$(".fn-rmitem",t.parent());a.length>0?(t.addClass("none"),a.removeClass("none")):t.addClass("active")}})}),!1})}this.ufollowInit()},ufollowInit:function(){var t=$(".fn-ufollowed");if(t.length>0){for(var e=[],a=0;a<t.length;a++)$(t[a]).data("id")&&e.push($(t[a]).data("id"));$.get(MP3.MP3_URL+MP3.XHR_URL+"/follow/get-ufollow-num",{ids:e.join(",")},function(e){if(e.data)for(var a=0;a<t.length;a++){var n=$(t[a]).data("id"),i=e.data[n];i>=0&&$(t[a]).html(i)}}),MP3.ACCOUNT_ID&&$.get(MP3.MP3_URL+MP3.XHR_URL+"/mydata/get-ufollow-list",function(t){if(t.data)for(var e=0;e<t.data.length;e++){var a=$(".fn-ufollow[data-id="+t.data[e].id+"]");if(a.length>0){var n=$(".fn-rmitem",a.parent());n.length>0?(a.addClass("none"),n.removeClass("none")):a.addClass("active")}}}),$(".fn-ufollow").click(function(){var t=$(this);return zmp3Login.show(function(){var e=$(".fn-ufollowed[data-id="+t.data("id")+"]");t.hasClass("active")?zmp3SongTool.removeItem(t,function(a){t.removeClass("active");var n=parseInt(e.html());n>0&&e.html(n-1)}):$.post(MP3.XHR_URL+"/post-follow",t.data(),function(e){if(e.data){t.addClass("active"),$(".fn-ufollowed[data-id="+t.data("id")+"]").html(e.data.total);var a=$(".fn-rmitem",t.parent());a.length>0?(t.addClass("none"),a.removeClass("none")):t.addClass("active")}})}),!1})}},showHide:function(t){t.hasClass("none")?t.removeClass("none"):t.addClass("none")},profile:function(t){$.get(MP3.XHR_URL+"/user/get-profile",{is_login:t?1:0},function(e){zmp3UI.buildInfo(e.data,t)},"json")},triggerGetCuccessUserInfo:function(){var t;document.createEvent?(t=document.createEvent("HTMLEvents")).initEvent("buildUserInfo",!0,!0):(t=document.createEventObject()).eventType="buildUserInfo",t.eventName="buildUserInfo",document.createEvent?document.dispatchEvent(t):document.fireEvent("on"+t.eventType,t)},buildInfo:function(t,e){MP3.ACCOUNT_ID=0,t.userid?(MP3.ACCOUNT_NAME=t.username,MP3.ACCOUNT_ID=t.userid,MP3.ZALO_ID=t.zaloid,MP3.DISPLAY_NAME=t.displayname,MP3.ACCOUNT_ID_ENCODED=t.useridencoded,"object"==typeof MP3&&void 0!==MP3.ACCOUNT_ID_ENCODED&&$("a.fn-my-channel").attr("href","/u/"+t.username+"."+MP3.ACCOUNT_ID_ENCODED),$("#userBox a.fn-profile").attr("href",window.location.origin+"/mymusic"),$("#userBox a.fn-profile").attr("target",""),$("#userBox a.fn-logout").attr("href",t.logout),$(".fn-userbox").removeClass("none"),$(".fn-guestbox").remove(),$("#loginBox").remove(),$(".fn-user-displayname").text(MP3.DISPLAY_NAME),t.zingid&&t.zingid>0&&$("#userBox a.fn-merge-asset").parent("li").remove(),zmp3UI.bodyMask(0),$("#userBox").append('<i class="fn_zme_info" style="display: none;" data_uid="'+t.userid+'" data-thumb="#userBox .fn-thumb" data-thumbsize="120"></i>'),t.is_vip?(zmp3UI.setBannerOff(!0),$(".toggle-ads").addClass("none"),MP3.VIP=1,$(".fn-vip").removeClass("none"),$(".fn-notvip").addClass("none"),t.noti_flag&&(zmp3UI.bodyMask(1),$("#loginNotiBox .fn-dname").html(t.name),$("#loginNotiBox").removeClass("none"))):($(".fn-vip").addClass("none"),$(".fn-notvip").removeClass("none"),MP3.VIP=0),t.is_mod&&(MP3.MOD=1,$(".fn-mod").removeClass("none")),""!=t.avatar&&null!=t.avatar||(t.avatar="https://s120.avatar.talk.zdn.vn/3/4/e/f/0/120/default.jpg"),$("#userBox .fn-thumb").attr("src",t.avatar),e&&$.isFunction(zmp3Login.succCallback)&&zmp3Login.succCallback(),this.triggerGetCuccessUserInfo()):(this.triggerGetCuccessUserInfo(),$(".fn-guestbox").removeClass("none"),$(".fn-userbox").addClass("none"),$(".fn-vip").addClass("none"),$(".fn-notvip").removeClass("none")),$(".fn-useravatar").attr("src",$(".fn-profile .fn-thumb").attr("src"))}},zmp3Toolbar={init:function(){if($(window).width()>1300){var t=$("#toolbar");$(".fn-toolbar",t).click(function(){var e=this;return zmp3Login.show(function(){if($(e).hasClass("active"))$("#toolbar .fn-box").addClass("none"),$(".fn-toolbar",t).removeClass("active"),zmp3UI.bodyMask(0);else switch(zmp3UI.bodyMask(1),$(".fn-toolbar",t).removeClass("active"),$(e).addClass("active"),$(e).data("box")){case"playlist":zmp3Toolbar.playlistbox();break;case"fav":zmp3Toolbar.favbox();break;case"his":zmp3Toolbar.hisbox();break;case"follow":zmp3Toolbar.followbox()}}),!1}),$(".fn-box[data-box=fav] .fn-group",t).click(function(){return zmp3Toolbar.favbox($(this).data("group")),$(".fn-group",t).removeClass("active"),$(this).addClass("active"),!1}),$(".fn-box[data-box=follow] .fn-group",t).click(function(){return zmp3Toolbar.followbox($(this).data("group")),$(".fn-group",t).removeClass("active"),$(this).addClass("active"),!1}),$("#toolbar .fn-box").each(function(){var t=this;onBlurBind(this,function(){var e=$("#toolbar .fn-toolbar[data-box="+$(t).data("box")+"]");e.hasClass("active")&&(e.removeClass("active"),zmp3UI.bodyMask(0)),$(t).addClass("none")})})}},playlistbox:function(){var t=$("#toolbar"),e=$(".fn-box[data-box=playlist]");zmp3Login.show(function(){var t=$(".fn-list",e);t.data("time")||(t.data("time",(new Date).getTime()),$.get(MP3.XHR_URL+"/user/get-playlist",function(a){if(a.data){var n=$(".fn-item",t)[0].cloneNode(!0);for(x in a.data){var i=a.data[x];if(i.id.length>2){var o=n.cloneNode(!0);$(".fn-name",o).html(i.name),i.artist&&$(".fn-artist",o).html(i.artist.length>60?"Nhiều nghệ sĩ":i.artist),$(".fn-link",o).attr("href",MP3.MP3_URL+i.link),$(".fn-edit-link",o).attr("href",i.edit_link),$(".fn-thumb",o).attr("src",MP3.IMG_URL+i.thumb).attr("alt",i.name),$(".fn-play",o).length>0&&$(".fn-play",o).html(i.play),$(o).removeClass("none"),t.append(o)}}$(".fn-total",e).html(a.total)}}))}),$(".fn-box",t).addClass("none"),e.removeClass("none")},favbox:function(t){t||(t="song");var e=$("#toolbar"),a=$(".fn-box[data-box=fav]",e),n=$(".fn-list[data-group="+t+"]",a);zmp3Login.show(function(){n.data("time")||(n.data("time",(new Date).getTime()),$.get(MP3.MP3_URL+MP3.XHR_URL+"/mydata/get-fav"+t,function(t){if(t.data){var e=$(".fn-item",n)[0].cloneNode(!0);for(x in t.data){var a=t.data[x];if(a.id.length>2){var i=e.cloneNode(!0);$(".fn-name",i).html(a.name),a.artist&&$(".fn-artist",i).html(a.artist.length>60?"Nhiều nghệ sĩ":a.artist),$(".fn-link",i).attr("href",MP3.MP3_URL+a.link),$(".fn-thumb",i).attr("src",MP3.IMG_URL+a.thumb).attr("alt",a.name),$(i).removeClass("none"),n.append(i)}}}}))}),$(".fn-list",a).addClass("none"),$(".fn-box",e).addClass("none"),a.removeClass("none"),n.removeClass("none")},followbox:function(t){t||(t="artist");var e=$("#toolbar"),a=$(".fn-box[data-box=follow]",e),n=$(".fn-list[data-group="+t+"]",a);zmp3Login.show(function(){n.data("time")||(n.data("time",(new Date).getTime()),$.get(MP3.MP3_URL+MP3.XHR_URL+"/mydata/get-follow-list?type="+t,function(e){if(e.data){var a=$(".fn-item",n)[0].cloneNode(!0);for(x in e.data){var i=e.data[x];if(i.id.length>2){var o=a.cloneNode(!0),s=t+"follow"+i.id;$(o).attr("id",s),$(".fn-name",o).html(i.name),$(".fn-link",o).attr("href",MP3.MP3_URL+i.link),$(".fn-thumb",o).attr("src",MP3.IMG_URL+i.thumb).attr("alt",i.name),$(".fn-total",o).html(zmp3Number.format(i.total)),$(o).data("type",t).data("id",i.id).data("name",i.name),$(".fn-remove",o).data("item","#"+s).click(function(){return zmp3SongTool.removeItem($($(this).data("item"))),!1}),$(o).removeClass("none"),n.append(o)}}}}))}),$(".fn-list",a).addClass("none"),$(".fn-box",e).addClass("none"),a.removeClass("none"),n.removeClass("none")},hisbox:function(t){t||(t="play");var e=$("#toolbar"),a=$(".fn-box[data-box=his]",e),n=$(".fn-list[data-group="+t+"]",a);zmp3Login.show(function(){n.data("time")||(n.data("time",(new Date).getTime()),$.get(MP3.MP3_URL+MP3.XHR_URL+"/mydata/get-history",{start:0,length:20},function(t){if(t.data){var e=$(".fn-item",n)[0].cloneNode(!0);for(x in t.data){var a=t.data[x];if(a.id.length>2){var i=e.cloneNode(!0),o=a.type,s="history"+a.id+a.time;$(i).attr("id",s).data(a).data("from","history"),$(".fn-name",i).html(a.name),$(".fn-artist",i).html(a.artist.length>60?"Nhiều nghệ sĩ":a.artist);var l=a.artist;switch($(".fn-"+a.type,i).removeClass("none"),a.type){case"video":o="video-clip";break;case"playlist":l=a.username;break;case"song":o="bai-hat"}$(".fn-link",i).attr("title",a.name+" - "+a.artist).attr("href",MP3.MP3_URL+"/"+o+"/"+a.name.stripViet("-")+"-"+l.stripViet("-")+"/"+a.id+".html"),$(".fn-thumb",i).attr("src",MP3.IMG_URL+a.thumb).attr("alt",a.name),$(".fn-remove",i).data("item","#"+s).click(function(){var t=$($(this).data("item")),e=t.data("order");return zmp3SongTool.removeItem(t,function(t){if(t.code<1)for(var a=n.children(".fn-item"),i=0;i<a.length;i++){var o=$(a[i]).data("order");e<o&&$(a[i]).data("order",o-1)}}),!1}),$(i).removeClass("none"),n.append(i)}}}}))}),$(".fn-list",a).addClass("none"),$(".fn-box",e).addClass("none"),a.removeClass("none"),n.removeClass("none")}},zmp3Common={trackPageview:function(t){"undefined"!=typeof ga&&ga("mp3.send","pageview",t),"undefined"!=typeof ZA&&ZA.trackPageview(t)},tracking:function(t){"undefined"!=typeof ga&&ga("mp3.send","pageview",t)},trackingOn:function(t,e,a){e||(e="");var n=t.attr("suglog"),i=t.attr("href");if(i){var o=t.attr("tracking");-1!=i.search(MP3.MP3_URL)&&(i="/"+i.replace(MP3.MP3_URL,"")),o&&(i+="?"+o),zmp3Common.tracking(e+i)}return!n||($.get(MP3.LOG_URL+n),a&&(a.ctrlKey||a.button>0)||setTimeout(function(){location.href=t.attr("href")},400),!1)},trackingDoneTrack:function(t,e,a,n){try{var i=!1;if("undefined"!=typeof ga&&a.totalTrack>=t){switch(e){case 0:case 2:a.currentTrack==t-1&&a.nextTrack==t&&(i=!0);break;case 1:case 3:a.totalPlayed==t+1&&(i=!0);break;default:n&&console.log("Not mapping any repeat mode.")}i&&ga("mp3.send","event",{eventCategory:"SaleReport",eventAction:"DoneTrack"+t,eventLabel:e})}else n&&console.log("ga <google analytics> is undefined.")}catch(t){n&&console.log(t)}},trackingShare:function(){$(".fn-track-sharelink",document).click(function(){var t=$(this).attr("data-type");if("facebook"!==t){var e=$(this).attr("href");""!=e&&void 0!==e&&"javascript:zShareNow();"!=e&&"javascript:void(0)"!=e||(e=window.location.href),ga("mp3.send","event",{eventCategory:"ShareZingMP3Desktop",eventAction:"Click-"+t,eventLabel:e})}})},trackPageviewFromUrl:function(){if("undefined"!=typeof ga&&""!=window.location.hash){var t=window.location.pathname+window.location.search+window.location.hash;ga("mp3.send","pageview",t),history.replaceState({},document.title,window.location.pathname+window.location.search)}}},zmp3Recommend={element:$("#block-recommend"),start:0,init:function(){zmp3Recommend.element.size()&&(zmp3Recommend.load(),0==parseInt(zmp3Storage.getParam("_zpAuto",0))&&$(".fn-autoplay").removeClass("btn-sw-on").addClass("btn-sw-off")),$(".fn-recommend-more").click(function(t){return zmp3Recommend.load(),!1})},load:function(){$.get(MP3.XHR_URL+"/recommend",zmp3Recommend.element.data(),function(t){var e='<img src="'+t.data.image_url+'" width="0" height="0" style="display: none;" alt="">';if($(e).appendTo("#imageaidac"),0===t.err&&t.data.items){t.data.items[0]&&(MP3.ITEM_NEXT_URL=t.data.items[0].link,MP3.ITEM_NEXT_TITLE=t.data.items[0].title);var a={items:t.data.items},n=_.template($("#"+zmp3Recommend.element.data("type")+"-recommend-template").text());zmp3Recommend.element.find("ul").append(n(a)),zmp3Recommend.element.removeClass("none"),zmp3Recommend.start=zmp3Recommend.start+10,zmp3Recommend.element.data("start",zmp3Recommend.start),(zmp3Recommend.start>=t.data.total||zmp3Recommend.start>=20)&&zmp3Recommend.element.find(".load-more").remove()}})}},zmp3Lyrics={mediaId:0,isInitUpload:!1,tpl:null,init:function(){$("#newLyrics form").submit(function(){return zmp3Lyrics.postnew(this),!1}),this.itemInit($("#lyrics"))},itemInit:function(t){$(document).on("click","#lyrics .fn-new",function(){var t=$(this).data("new");return"undefined"==typeof plupload?loadScript("https://zmp3-static.zadn.vn/skins/zmp3-v4.2/plugins/plupload/plupload.full.min.js",function(){zmp3Lyrics.initUploadLRC("lrcUpload","lrcUploadBox"),zmp3Lyrics.newBoxShow(t)}):zmp3Lyrics.newBoxShow(t),!1}),$(document).on("click","#lyrics .fn-next",function(){var t=$(this).data("item"),e=$(this).data("index");return zmp3Lyrics.show($(t+e)),!1}),$(document).on("click","#lyrics .fn-prev",function(){var t=$(this).data("item"),e=$(this).data("index");return zmp3Lyrics.show($(t+e)),!1}),$(".fn-delete",t).click(function(){for(var t=$("#lyrics .fn-lyrics"),e=0;e<t.length;e++)if(!$(t[e]).hasClass("none")){zmp3Lyrics.remove($(t[e]));break}return!1})},postnew:function(t){return t.content.value.trim().length<200||t.content.value.trim().length>4e3?zmp3UI.showMsg("Nội dung cần ít nhất 200 ký tự và tối đa 4000 ký tự!",1):$(t).data("processing")||($(t).data("processing",!0),$.post($(t).attr("action"),$(t).serialize(),function(e){0==e.err&&(t.reset(),$("#newLyrics").addClass("none"),zmp3Lyrics.getLyrics(zmp3Lyrics.mediaId,!0)),zmp3UI.showMsg(e.msg,e.err),$(t).data("processing",!1)},"json")),!1},getLyrics:function(t,e){t&&(t=t.toLowerCase()),null===this.tpl&&(this.tpl=$(".fn-lyrics")[0].cloneNode(!0,!0),$(this.tpl).removeClass("none")),e&&$(".fn-lyrics"+t).remove(),$(".fn-lyrics"+t).length<1?(this.songId!=t||e)&&(this.songId=t):zmp3Lyrics.show($("#lyrics"+t+"1"))},remove:function(t){$.post("/json/mydata/delete-lyrics",t.data(),function(e){e.code<1&&$(".fn-content",t).addClass("disabled"),zmp3UI.showMsg(e.msg,e.code)},"json")},buildLyrics:function(t,e){$.get(MP3.XHR_URL+"/lyrics/get-lyrics?media_id="+t,function(a){if($("#lyrics").show(),$("#newLyrics").addClass("none"),0!==a.err||!a.data){return $("#lyrics-song .fn-container").html('<div class="fn-lyrics"><p class="fn-nolyrics no-lyrics text-center">Lyrics của bài hát này chưa được cập nhật.<br/><a href="#" class="fn-new" data-box="#newLyrics">Nhấn vào đây</a> để đóng góp lời bài hát cho chúng tôi.</p>'),void $("#lyrics .group").addClass("none")}var n={id:t,title:e},i={items:a.data,total:a.data.length,media:n},o=_.template($("#lyrics-item-template").text());$("#lyrics-song .fn-container").html(o(i)),$("#lyrics .group").removeClass("none"),$("#lyrics .fn-expand").removeClass("none"),$("#lyrics .fn-expand").text("Xem thêm")})},buildItem:function(t,e,a,n){a=parseInt(a)+1;var i=zmp3Lyrics.tpl.cloneNode(!0,!0),o="lyrics"+t+a;$(i).attr("id",o).addClass("fn-lyrics fn-lyrics"+t).data("songid",t).data("id",e.id),$(".fn-name",i).html((e.name+" - "+e.artist).substring(0,66)),$(".fn-content",i).html(e.content),$(".fn-version",i).html(a+"/"+n),$("#lyrics .fn-container").append(i),a<n?$(".fn-next",i).removeClass("disabled").data("item","#lyrics"+t+(a+1)).click(function(){return zmp3Lyrics.show($($(this).data("item"))),!1}):$(".fn-next",i).addClass("disabled"),a>1?$(".fn-prev",i).removeClass("disabled").data("item","#lyrics"+t+(a-1)).click(function(){return zmp3Lyrics.show($($(this).data("item"))),!1}):$(".fn-prev",i).addClass("disabled"),$(".fn-user",i).html(e.user),$(i).append('<i class="fn_zme_info fn'+e.user+'" style="display: none;" data-ref=".fn'+e.user+'" data_uname="'+e.user+'" data-dname="#'+o+' .fn-user"></i>'),$("#lyrics .fn-container").append(i)},show:function(t){return $(".fn-lyrics").addClass("none"),$(".fn-content",t).html().length<10?($(".fn-nolyrics").removeClass("none"),$(".fn-wlyrics").addClass("none")):($(".fn-nolyrics").addClass("none"),$(".fn-wlyrics").removeClass("none")),t.removeClass("none"),!1},newBoxShow:function(t){var e=$(".fn-playlist-item.fn-current"),a=$("#newLyrics form")[0];e.length>0&&(a.media_id.value=e.data("id"),zmp3Lyrics.mediaId=e.data("id")),$("#newLyrics").removeClass("none"),"lrc"==t?zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lrc"]')):zmp3Tab.showTab($('.fn-tab[data-panel=".fn-sub-lyrics"]'))},initUploadLRC:function(t,e){e=$("#"+e)[0],new plupload.Uploader({browse_button:t,runtimes:"html5,html4",url:$("#"+t).data("url"),multi_selection:!1,filters:{max_file_size:"10mb",mime_types:[{title:"LRC files",extensions:"lrc"}]},init:{FilesAdded:function(t,a){var n=$(t.settings.browse_button[0]);plupload.each(a,function(t){$(e).attr("id",t.id),$(".fn-name",e).html(t.name),$(".fn-upload-fail",e).addClass("none"),$(".fn-save",e).addClass("disabled").html("Vui lòng chờ");var a=new plupload.Uploader({browse_button:"uploadTmp",runtimes:"html5,html4",url:n.data("url"),init:{UploadProgress:function(t,a){$(".fn-save",e).html("Vui lòng chờ, đang upload "+Math.floor(a.percent)+"%")},FileUploaded:function(t,a,n){(n=$.parseJSON(n.response)).errorCode||$(".fn-save",e).data("filename",n.data.filename).removeClass("disabled").html("Gửi")},Error:function(t,a){$(".fn-upload-fail",e).removeClass("none")}}});a.init(),a.addFile(t),setTimeout(function(){a.start()},200)})}}}).init(),$(".fn-save",e).click(function(){var t=$(this);return t.hasClass("disabled")||(t.addClass("disabled").html("Vui lòng chờ"),$.post(t.data("url"),t.data(),function(e){e.code<1&&$("#newLyrics").addClass("none"),zmp3UI.showMsg(e.msg,e.code),t.html("Gửi")},"json")),!1})}},zmp3Like=function(){function t(t){}function e(t){$(".fn-count",l).html(zmp3Number.format(t))}function a(t){isNaN(MP3.ACCOUNT_ID)&&(MP3.ACCOUNT_ID=0)}function n(t){$.getJSON(MP3.XHR_URL+"/like/get-token?id="+l.data("id")+"&callback=?",{dataType:"json"},function(e){e.error||(l.data("token",e.token),l.data("key",e.key),t&&t())})}function i(){$(document).on("click",".fn-zlike",function(){return MP3.ACCOUNT_ID?(s($(this)),!1):zmp3Login.show(function(){zmp3Like.getToken(function(){zmp3Like.stats()})})}),$(".fn-count",l).click(function(){d=1,$.getJSON(m+"/list?uid="+MP3.ACCOUNT_ID+"&sid="+l.data("key")+"&token="+l.data("token")+"&page="+d+"&count=10&callback=?",function(e){e.result.total>0&&t(e)})})}function o(t){$.getJSON(MP3.XHR_URL+"/like/get-like?id="+t.data("id")+"&type="+t.data("type"),function(a){a.data&&(t.data("token",a.data.token),t.data("key",a.data.key),i(),MP3.ZLIKE_KEY=a.data.key,MP3.ZLIKE_TOKEN=a.data.token,$.getJSON(m+"/get?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?",function(a){if("object"==typeof a){var n=$(".fn-btn",t);n.html(a.like?n.html().replace("Thích","Bỏ thích"):n.html().replace("Bỏ thích","Thích")),e(r=a.total),t.data("like",a.like?1:0)}}))})}function s(){var t="";t=1!=l.data("like")?"https://like.mp3.zing.vn/like?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?":"https://like.mp3.zing.vn/unlike?uid="+MP3.ACCOUNT_ID+"&sid="+MP3.ZLIKE_KEY+"&token="+MP3.ZLIKE_TOKEN+"&callback=?",$.getJSON(t,function(t){if("object"==typeof t&&!t.error){var a=$(".fn-btn",l);1!=l.data("like")?(a.html(a.html().replace("Thích","Bỏ thích")),l.data("like",1),$(".func-like").addClass("active"),r++):(a.html(a.html().replace("Bỏ thích","Thích")),l.data("like",0),$(".func-like").removeClass("active"),r--),e(r)}})}var l=null,r=0,d=1,m="https://like.mp3.zing.vn";return{init:function(){(l=$($(".fn-zlike")[0])).length<1||o(l)},stats:function(){a()},getToken:function(t){n(t)}}}(),zmp3Suggest={lastQ:"",tplArtist:null,lastcall:0,tplAlbum:null,tplSong:null,tplVideo:null,timeoutHandle:null,firstRequestTopKeyword:!1,retTopKeyword:null,acurl:"//ac.global.mp3.zing.vn/complete/desktop?type=artist,album,video,song&num=3",init:function(){var t=$("#sug"),e=$(".fn-result",t);MP3.IS_PC&&$('input[name="q"]').focus(),-1!=location.pathname.search("/tim-kiem/")&&$("form",t).attr("action",location.pathname),$(window).disablescroll(),$(window).disablescroll("undo");var a=new RegExp("q=(.*?)(&|$)").exec(location.search);a&&$("input[name=q]",t).val(decodeURIComponent(decodeURI(a[1]).replace(new RegExp("\\+","g")," "))),null!==document.getElementById("tplSugArtist")&&(tplArtist=document.getElementById("tplSugArtist").cloneNode(!0)),null!==document.getElementById("tplSugAlbum")&&(tplAlbum=document.getElementById("tplSugAlbum").cloneNode(!0)),null!==document.getElementById("tplSugSong")&&(tplSong=document.getElementById("tplSugSong").cloneNode(!0)),null!==document.getElementById("tplSugVideo")&&(tplVideo=document.getElementById("tplSugVideo").cloneNode(!0)),null!==document.getElementById("tplTopKeyword")&&(tplTopKeyword=document.getElementById("tplTopKeyword").cloneNode(!0)),e.mCustomScrollbar({scrollInertia:0,scrollbarPosition:"outside",autoHideScrollbar:!0,autoExpandScrollbar:!0,keyboard:{enable:!0},mouseWheel:{preventDefault:!0}}),this.clearResult(),onBlurBind('input[name="q"]',function(){e.addClass("none")}),$("form",t).submit(function(){var t=$(".fn-list .fn-item.active",e);return t.length>0?(location.href=$(".fn-link",t).attr("href"),!1):!($.trim($('input[name="q"]').val()).length<1)&&void 0}),$('input[name="q"]',t).keydown(function(t){if(13===t.keyCode){if($(".fn-list .fn-item.active",e).length>0)return!1}else{var a=$(".fn-list .fn-item",e);if(38===t.keyCode||40===t.keyCode){if(a.length>0){for(var n=-1,i=0;i<a.length;i++)if($(a[i]).hasClass("active")){n=i;break}switch(a.removeClass("active"),t.keyCode){case 38:n>0?$(a[n-1]).addClass("active"):$(a[a.length-1]).addClass("active");break;case 40:n<a.length-1?$(a[n+1]).addClass("active"):$(a[0]).addClass("active")}}return!1}t.keyCode<65&&t.shiftKey||t.keyCode>165&&t.keyCode<200||this.value.length<1&&t.keyCode}}).keyup(function(t){if(!(t.keyCode<65&&t.shiftKey||t.keyCode>165&&t.keyCode<200||this.value.length<1&&32==t.keyCode)){zmp3Suggest.timeoutHandle&&(clearTimeout(zmp3Suggest.timeoutHandle),zmp3Suggest.timeoutHandle=null);var e=this;zmp3Suggest.timeoutHandle=setTimeout(function(){zmp3Suggest.suggest($(e))},500),32==t.keyCode&&(clearTimeout(zmp3Suggest.timeoutHandle),zmp3Suggest.timeoutHandle=null,zmp3Suggest.suggest($(e)))}}).focus(function(){zmp3Suggest.suggest($(this))}).click(function(){zmp3Suggest.suggest($(this))}),e.height($(window).height()-42)},clearResult:function(){$("#sugResult").data("current",-1),$("#tplSugArtist").remove(),$("#tplSugAlbum").remove(),$("#tplSugSong").remove(),$("#tplSugVideo").remove()},resize:function(){$("#sugResult").height("auto")},suggest:function(t){var e="",a=0;if("string"==typeof t?(e=t,a=t.length):(e=t.val(),a=t.val().length),a>1){$("#sugTopKeyword").addClass("none");var n=$.now();this.lastQ!==e&&this.lastcall+50<n?(zmp3Suggest.lastcall=n,zmp3Suggest.lastQ=e,$.getJSON(zmp3Suggest.acurl+"&callback=?",{query:zmp3Suggest.lastQ},function(t){if(zmp3Suggest.lastQ===e&&($("#sugTop .fn-list").empty(),$("#sugSong .fn-list").empty(),$("#sugAlbum .fn-list").empty(),$("#sugVideo .fn-list").empty(),$("#sugArtist .fn-list").empty(),t.data)){if($(tplArtist).data("highlight",e),$(tplSong).data("highlight",e),$(tplAlbum).data("highlight",e),$(tplVideo).data("highlight",e),t.data[4]&&void 0!==t.data[4].top&&""!=t.data[4].top){if($("#sugTop").removeClass("none"),void 0!==t.data[4].top.type&&""!=t.data[4].top.type)switch(t.data[4].top.type){case"song":$("#sugTop .ics.zicon").addClass("ics-song"),$("#sugTop .ics.zicon").removeClass("ics-artist"),$("#sugTop .ics.zicon").removeClass("ics-album"),$("#sugTop .ics.zicon").removeClass("ics-video");var a=t.data[4].top,n=tplSong.cloneNode(!0);$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$(".fn-artist",n).addClass("fn-highlight").data("highlight",e).html(a.artist);s="/bai-hat/"+a.name.stripViet("-")+"-"+a.artist.stripViet("-")+"/"+a.id+".html";$("a.fn-link",n).attr("title",a.name+" - "+a.artist).attr("href",s),$(n).removeClass("none"),$("#sugTop .fn-list").append(n);break;case"album":$("#sugTop .ics.zicon").addClass("ics-album"),$("#sugTop .ics.zicon").removeClass("ics-song"),$("#sugTop .ics.zicon").removeClass("ics-artist"),$("#sugTop .ics.zicon").removeClass("ics-video"),""===(a=t.data[4].top).thumb&&(a.thumb="default");n=tplAlbum.cloneNode(!0);$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$(".fn-artist",n).addClass("fn-highlight").data("highlight",e).html(a.artist);s="/album/"+a.name.stripViet("-")+"-"+a.artist.stripViet("-")+"/"+a.id+".html";$("a.fn-link",n).attr("title",a.name+" - "+a.artist).attr("href",s),$("img.fn-thumb",n).attr("src","https://zmp3-photo-td.zadn.vn/thumb/94_94/"+a.thumb).attr("alt",a.name),$(n).removeClass("none"),$("#sugTop .fn-list").append(n);break;case"artist":$("#sugTop .ics.zicon").addClass("ics-artist"),$("#sugTop .ics.zicon").removeClass("ics-song"),$("#sugTop .ics.zicon").removeClass("ics-album"),$("#sugTop .ics.zicon").removeClass("ics-video"),""===(a=t.data[4].top).thumb&&(a.thumb="default");var n=tplArtist.cloneNode(!0),i="/nghe-si/"+(a.aliasName?a.aliasName:a.name_stripviet?a.name_stripviet:a.name.stripViet("-")),o=a.id;$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$("a.fn-link",n).attr("title",a.name).attr("href",i).attr("data-id",o),$("img.fn-thumb",n).attr("src","https://zmp3-photo-td.zadn.vn/thumb/94_94/"+a.thumb).attr("alt",a.name),$(n).removeClass("none"),$("#sugTop .fn-list").append(n);break;case"video":$("#sugTop .ics.zicon").addClass("ics-video"),$("#sugTop .ics.zicon").removeClass("ics-artist"),$("#sugTop .ics.zicon").removeClass("ics-album"),$("#sugTop .ics.zicon").removeClass("ics-song"),""===(a=t.data[4].top).thumb&&(a.thumb="default");n=tplVideo.cloneNode(!0);$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$(".fn-artist",n).addClass("fn-highlight").data("highlight",e).html(a.artist);s="/video-clip/"+a.name.stripViet("-")+"-"+a.artist.stripViet("-")+"/"+a.id+".html";$("a.fn-link",n).attr("title",a.name+" - "+a.artist).attr("href",s),$("img.fn-thumb",n).attr("src","https://zmp3-photo-td.zadn.vn/thumb/128_72/"+a.thumb).attr("alt",a.name),$(n).removeClass("none"),$("#sugTop .fn-list").append(n)}}else $("#sugTop").addClass("none");if(t.data[1].artist.length>0){for(x in t.data[1].artist){""===(a=t.data[1].artist[x]).thumb&&(a.thumb="default");var n=tplArtist.cloneNode(!0),i="/nghe-si/"+(a.aliasName?a.aliasName:a.name_stripviet?a.name_stripviet:a.name.stripViet("-")),o=a.id;$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$("a.fn-link",n).attr("title",a.name).attr("href",i).attr("data-id",o),$("img.fn-thumb",n).attr("src","https://zmp3-photo-td.zadn.vn/thumb/94_94/"+a.thumb).attr("alt",a.name),$(n).removeClass("none"),$("#sugArtist .fn-list").append(n)}$("#sugArtist").removeClass("none")}else $("#sugArtist").addClass("none");if(t.data[2].album.length>0){for(x in t.data[2].album){""===(a=t.data[2].album[x]).thumb&&(a.thumb="default");n=tplAlbum.cloneNode(!0);$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$(".fn-artist",n).addClass("fn-highlight").data("highlight",e).html(a.artist);s="/album/"+a.name.stripViet("-")+"-"+a.artist.stripViet("-")+"/"+a.id+".html";$("a.fn-link",n).attr("title",a.name+" - "+a.artist).attr("href",s),$("img.fn-thumb",n).attr("src","https://zmp3-photo-td.zadn.vn/thumb/94_94/"+a.thumb).attr("alt",a.name),$(n).removeClass("none"),$("#sugAlbum .fn-list").append(n)}$("#sugAlbum").removeClass("none")}else $("#sugAlbum").addClass("none");if(t.data[3].video.length>0){for(x in t.data[3].video){""===(a=t.data[3].video[x]).thumb&&(a.thumb="default");n=tplVideo.cloneNode(!0);$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$(".fn-artist",n).addClass("fn-highlight").data("highlight",e).html(a.artist);s="/video-clip/"+a.name.stripViet("-")+"-"+a.artist.stripViet("-")+"/"+a.id+".html";$("a.fn-link",n).attr("title",a.name+" - "+a.artist).attr("href",s),$("img.fn-thumb",n).attr("src","https://zmp3-photo-td.zadn.vn/thumb/128_72/"+a.thumb).attr("alt",a.name),$(n).removeClass("none"),$("#sugVideo .fn-list").append(n)}$("#sugVideo").removeClass("none")}else $("#sugVideo").addClass("none");if(t.data[0].song.length>0){for(x in t.data[0].song){""===(a=t.data[0].song[x]).thumb&&(a.thumb="default");n=tplSong.cloneNode(!0);$(".fn-name",n).addClass("fn-highlight").data("highlight",e).html(a.name),$(".fn-artist",n).addClass("fn-highlight").data("highlight",e).html(a.artist);var s="/bai-hat/"+a.name.stripViet("-")+"-"+a.artist.stripViet("-")+"/"+a.id+".html";$("a.fn-link",n).attr("title",a.name+" - "+a.artist).attr("href",s),$(n).removeClass("none"),$("#sugSong .fn-list").append(n)}$("#sugSong").removeClass("none")}else $("#sugSong").addClass("none");$("#sugResult").removeClass("none"),zmp3UI.highlight()}zmp3Suggest.resize()})):($("#sugResult").removeClass("none"),zmp3Suggest.resize())}else this.clearResult()},showTopKeyword:function(){this.firstRequestTopKeyword?null!=this.retTopKeyword&&""===$("#sug .input-txt").val()&&($("#sugTop").addClass("none"),$("#sugArtist").addClass("none"),$("#sugSong").addClass("none"),$("#sugVideo").addClass("none"),$("#sugAlbum").addClass("none"),$("#sugResult").removeClass("none"),$("#sugTopKeyword").removeClass("none")):(this.firstRequestTopKeyword=!0,$.getJSON("//ac.mp3.zing.vn/complete/topkeyword?callback=?",{},function(t){if(zmp3Suggest.retTopKeyword=t,""===$("#sug .input-txt").val()&&($("#sugTop").addClass("none"),$("#sugArtist").addClass("none"),$("#sugSong").addClass("none"),$("#sugVideo").addClass("none"),$("#sugAlbum").addClass("none"),t.data.length>0)){for(x in t.data){$("#sugTopKeyword").removeClass("none");var e=t.data[x],a=tplTopKeyword.cloneNode(!0);$(".fn-name",a).addClass("fn-highlight").data("highlight","").html(e),$(".fn-name",a).addClass(x),$(".fn-name."+x,a).click(function(){var t=$(this).context.innerText;zmp3Suggest.suggest(t),$("#sug .input-txt").val(t)}),$(a).removeClass("none"),$("#sugTopKeyword .fn-list").append(a)}zmp3UI.highlight(),$("#sugResult").removeClass("none")}zmp3Suggest.resize()}))}},zmp3Counter={init:function(){var t="",e="";$(".fn-counter").each(function(a){0===a?(t+=$(this).data("id"),e=$(this).data("type")):t=t+","+$(this).data("id")}),t&&e&&$.get(MP3.XHR_URL+"/get-counters?ids="+t+"&type="+e,function(t){if(0===t.err)for(var e=0;e<t.data.length;e++)if(t.data[e]){var a=t.data[e];$("#counter-"+a.id).html(zmp3Number.format(a.total))}})}},zmp3Embed={init:function(){zmp3Embed.create($("#embedHeight").val(),$("#embedWidth").val(),$("#autoPlay").prop("checked"),$("#oldStyle").prop("checked")),$("#embedSize").change(function(){if($(this).val().length>2){var t=$(this).val().split("x");$("#embedHeight").val(t[1]),$("#embedWidth").val(t[0]),zmp3Embed.create($("#embedHeight").val(),$("#embedWidth").val(),$("#autoPlay").prop("checked"),$("#oldStyle").prop("checked")),$("#embedSize option:last-child").is(":selected")?$(".option-select").removeClass("none"):$(".option-select").addClass("none")}}),$(".fn-input-number").keydown(function(t){return isInputNumber(t.keyCode)}),$("#embedBox input").change(function(){zmp3Embed.create($("#embedHeight").val(),$("#embedWidth").val(),$("#autoPlay").prop("checked"),$("#oldStyle").prop("checked"))})},create:function(t,e,a,n){var i=$("#embedUrl").val();if(!0===a&&(i+="?start=true"),n){var o='<object width="'+e+'" height="'+t+'">';o+='<param name="movie" value="'+i+'" />',o+='<param name="quality" value="high" />',o+='<param name="wmode" value="transparent" />',o+='<param name="allowfullscreen" value="true"/>',o+='<param name="allowscriptaccess" value="always"/>',o+='<embed allowscriptaccess="always" allowfullscreen="true" width="'+e+'" height="'+t+'" src="'+i+'" quality="high" wmode="transparent"></embed>',o+="</object>",o+="<br />",$("#embed").val(o)}else $("#embed").val('<iframe scrolling="no" width="'+e+'" height="'+t+'" src="'+i+'" frameborder="0" allowfullscreen="true"></iframe>')}},zmp3Raking={init:function(){var t=$(".fn-raking");if(t.length>0){var e=t.data("id"),a=t.data("type");$.get(MP3.XHR_URL+"/media/get-raking?id="+e+"&type="+a,function(e){if(0===e.err&&e.data){var a='<a href="'+e.data.link+'" title="Zing Chart">No.'+e.data.raking+" #zingchart</a>";t.html(a).addClass("media-raking"+e.data.raking)}})}}};$(document).ready(function(){$(window).load(function(){$(window).height()>$("body").height()?$("body").addClass("fixed-footer"):$("body").removeClass("fixed-footer"),zmp3UI.sidebar(),dynamic()}),$(window).resize(function(){$(window).height()>$("body").height()?$("body").addClass("fixed-footer"):$("body").removeClass("fixed-footer"),zmp3UI.sidebar(),dynamic(),zmp3Suggest.resize()}),$(document).scroll(function(t){dynamic(),zmp3UI.sidebar()}),zmp3Common.trackPageviewFromUrl(),zmp3Common.trackingShare(),zmp3UI.init(),zmp3Login.init(),zmp3Suggest.init(),zmp3SongTool.init(),zmp3User.init(),zmp3Tab.init(),zmp3Recommend.init(),zmp3Lyrics.init(),zmp3Like.init(),zmp3Counter.init(),zmp3Embed.init(),zmp3Raking.init(),MP3.VIP||"undefined"==typeof ZVip||$(".fn-viprequire").click(function(t){if(!MP3.VIP)return ZVip.Fpackage($(this).data("step")),!1})});